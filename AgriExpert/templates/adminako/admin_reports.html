{% extends 'adminako/base_admin.html' %}
{% load static %}

{% block content %}
<style>
    /* Print Styles */
    .print-header, .print-footer {
        display: none;
    }
    
    @media print {
        body * {
            visibility: hidden;
        }
        
        .print-section, .print-section * {
            visibility: visible;
        }
        
        .print-section {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }
        
        .print-header, .print-footer {
            display: block;
        }
        
        .no-print {
            display: none !important;
        }
        
        .btn, .nav-tabs, .filter-buttons {
            display: none !important;
        }
    }
    
    .print-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #28a745;
    }
    
    .print-header h2 {
        color: #28a745;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .print-header h3 {
        color: #333;
        font-size: 1.2rem;
        margin: 5px 0;
    }
    
    .print-header p {
        color: #666;
        margin: 3px 0;
    }
    
    .print-footer {
        margin-top: 50px;
        padding-top: 20px;
        border-top: 2px solid #ddd;
        text-align: center;
        color: #666;
    }
    
    .report-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 25px;
        margin-bottom: 30px;
    }
    
    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .report-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
    }
    
    .filter-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 15px;
    }
    
    .filter-btn {
        padding: 8px 16px;
        border-radius: 5px;
        border: 2px solid transparent;
        transition: all 0.3s;
    }
    
    .filter-btn.active {
        border-width: 2px;
        font-weight: bold;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    
    .search-box {
        margin-bottom: 20px;
    }
    
    .search-box input {
        border-radius: 8px;
        padding: 12px;
        border: 2px solid #e0e0e0;
    }
    
    .search-box input:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
    }
    
    .stat-card.green {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .stat-card.blue {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .stat-card.orange {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    
    .stat-card.red {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .table-responsive {
        border-radius: 8px;
        overflow: hidden;
    }
    
    .table {
        margin-bottom: 0;
    }
    
    .table thead th {
        background-color: #28a745;
        color: white;
        font-weight: 600;
        border: none;
        padding: 15px 10px;
    }
    
    .table tbody tr:hover {
        background-color: #f8f9fa;
    }
    
    .badge-custom {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }
    
    .nav-tabs {
        border-bottom: 3px solid #28a745;
        margin-bottom: 30px;
    }
    
    .nav-tabs .nav-link {
        color: #666;
        font-weight: 600;
        border: none;
        padding: 12px 24px;
    }
    
    .nav-tabs .nav-link.active {
        color: #28a745;
        background-color: #f8f9fa;
        border-bottom: 3px solid #28a745;
    }
    
    /* User Management Specific Styles */
    .action-buttons {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
    }
    
    .action-buttons .btn {
        font-size: 0.75rem;
        padding: 4px 8px;
    }
    
    .profile-img-small {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }
</style>

<div class="container-fluid mt-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-center fw-bold mb-2" style="color: #28a745;">
                <i class="fas fa-file-alt"></i> Mga Ulat ng Sistema
            </h1>
            <p class="text-center text-muted">Municipal Agriculture Office of Victoria, Oriental Mindoro</p>
        </div>
    </div>
    
    <!-- Statistics Overview -->
    <div class="stats-grid no-print">
        <div class="stat-card green">
            <i class="fas fa-users fa-2x"></i>
            <div class="stat-number">{{ total_farmers }}</div>
            <div class="stat-label">Kabuuang Magsasaka</div>
        </div>
        <div class="stat-card blue">
            <i class="fas fa-user-tie fa-2x"></i>
            <div class="stat-number">{{ total_experts }}</div>
            <div class="stat-label">Kabuuang Eksperto</div>
        </div>
        <div class="stat-card orange">
            <i class="fas fa-comments fa-2x"></i>
            <div class="stat-number">{{ total_consultations }}</div>
            <div class="stat-label">Kabuuang Konsultasyon</div>
        </div>
        <div class="stat-card red">
            <i class="fas fa-bug fa-2x"></i>
            <div class="stat-number">{{ total_predictions }}</div>
            <div class="stat-label">Kabuuang Deteksyon</div>
        </div>
    </div>
    
    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs no-print" id="reportTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button">
                <i class="fas fa-user-cog"></i> Pamamahala ng User
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="demographics-tab" data-bs-toggle="tab" data-bs-target="#demographics" type="button">
                <i class="fas fa-users"></i> Demograpiko
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="consultations-tab" data-bs-toggle="tab" data-bs-target="#consultations" type="button">
                <i class="fas fa-comments"></i> Konsultasyon
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="predictions-tab" data-bs-toggle="tab" data-bs-target="#predictions" type="button">
                <i class="fas fa-bug"></i> Deteksyon
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="posts-tab" data-bs-toggle="tab" data-bs-target="#posts" type="button">
                <i class="fas fa-newspaper"></i> Mga Post
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="library-tab" data-bs-toggle="tab" data-bs-target="#library" type="button">
                <i class="fas fa-book"></i> Aklatan
            </button>
        </li>
    </ul>
    
    <!-- Tab Content -->
    <div class="tab-content" id="reportTabsContent">
        
        <!-- USER MANAGEMENT TAB -->
        <div class="tab-pane fade" id="users" role="tabpanel">
            
            <!-- Experts Management -->
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-user-tie"></i> Pamamahala ng mga Eksperto</h3>
                    <div class="filter-buttons">
                        <button class="btn btn-secondary filter-btn active" onclick="filterManagementExperts('all')">Lahat ({{ experts.count }})</button>
                        <button class="btn btn-warning filter-btn" onclick="filterManagementExperts('Pending')">Pending ({{ pending_experts.count }})</button>
                        <button class="btn btn-success filter-btn" onclick="filterManagementExperts('Approved')">Approved ({{ approved_experts.count }})</button>
                        <button class="btn btn-danger filter-btn" onclick="filterManagementExperts('Rejected')">Rejected ({{ rejected_experts.count }})</button>
                    </div>
                </div>
                
                <div class="search-box">
                    <input type="text" class="form-control" id="expertsManagementSearch" placeholder="Maghanap ng eksperto...">
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Profile</th>
                                <th>Username</th>
                                <th>Buong Pangalan</th>
                                <th>Email</th>
                                <th>Barangay</th>
                                <th>Telepono</th>
                                <th>Posisyon</th>
                                <th>License Number</th>
                                <th>Status</th>
                                <th>Mga Aksyon</th>
                            </tr>
                        </thead>
                        <tbody id="expertsManagementTableBody">
                            {% for expert in experts %}
                            <tr class="expert-management-row" data-status="{{ expert.status }}">
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    {% if expert.profile_picture %}
                                        <img src="{{ expert.profile_picture }}" class="profile-img-small" alt="Profile" onerror="this.src='{% static 'images/default-profile.png' %}'">
                                    {% else %}
                                        <img src="{% static 'images/default-profile.png' %}" class="profile-img-small" alt="Default Profile">
                                    {% endif %}
                                </td>
                                <td>{{ expert.username }}</td>
                                <td>{{ expert.first_name }} {{ expert.middle_name|default:"" }} {{ expert.last_name }}</td>
                                <td>{{ expert.email }}</td>
                                <td>{{ expert.barangay }}</td>
                                <td>{{ expert.phone_number }}</td>
                                <td>{{ expert.position|default:"N/A" }}</td>
                                <td>{{ expert.license_number|default:"N/A" }}</td>
                                <td>
                                    <span class="badge-custom {% if expert.status == 'Approved' %}bg-success{% elif expert.status == 'Pending' %}bg-warning{% else %}bg-danger{% endif %}">
                                        {{ expert.status }}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="{% url 'view_expert' expert.id %}" class="btn btn-info btn-sm" title="Tingnan at I-edit Status">
                                            <i class="fas fa-edit"></i> Manage
                                        </a>
                                        {% if expert.proof_of_expertise %}
                                        <button class="btn btn-warning btn-sm" onclick="previewFile('{{ expert.proof_of_expertise }}')" title="Tingnan ang Proof">
                                            <i class="fas fa-file-alt"></i> Proof
                                        </button>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="11" class="text-center">Walang eksperto</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Farmers Management -->
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-users"></i> Pamamahala ng mga Magsasaka</h3>
                </div>
                
                <div class="search-box">
                    <input type="text" class="form-control" id="farmersManagementSearch" placeholder="Maghanap ng magsasaka...">
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Profile</th>
                                <th>Username</th>
                                <th>Buong Pangalan</th>
                                <th>Email</th>
                                <th>Barangay</th>
                                <th>Telepono</th>
                                <th>Lawak ng Sakahan (ha)</th>
                                <th>Mga Aksyon</th>
                            </tr>
                        </thead>
                        <tbody id="farmersManagementTableBody">
                            {% for farmer in farmers %}
                            <tr class="farmer-management-row">
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    {% if farmer.profile_picture %}
                                        <img src="{{ farmer.profile_picture }}" class="profile-img-small" alt="Profile">
                                    {% else %}
                                        <img src="{% static 'images/default-profile.png' %}" class="profile-img-small" alt="Default Profile">
                                    {% endif %}
                                </td>
                                <td>{{ farmer.username }}</td>
                                <td>{{ farmer.first_name }} {{ farmer.middle_name|default:"" }} {{ farmer.last_name }}</td>
                                <td>{{ farmer.email }}</td>
                                <td>{{ farmer.barangay }}</td>
                                <td>{{ farmer.phone_number }}</td>
                                <td>{{ farmer.farm_size }}</td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="{% url 'view_farmer' farmer.id %}" class="btn btn-info btn-sm" title="Tingnan">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{% url 'admin_view_farmer' farmer.id %}" class="btn btn-warning btn-sm" title="I-edit">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="9" class="text-center">Walang magsasaka</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- DEMOGRAPHICS TAB -->
        <div class="tab-pane fade show active" id="demographics" role="tabpanel">
            
            <!-- Experts Report -->
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-user-tie"></i> Ulat ng mga Eksperto</h3>
                    <button class="btn btn-success no-print" onclick="printReport('expertsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="expertsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng mga Eksperto</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="filter-buttons no-print">
                        <button class="btn btn-secondary filter-btn active" onclick="filterExperts('all')">Lahat ({{ experts.count }})</button>
                        <button class="btn btn-warning filter-btn" onclick="filterExperts('Pending')">Pending ({{ pending_experts.count }})</button>
                        <button class="btn btn-success filter-btn" onclick="filterExperts('Approved')">Approved ({{ approved_experts.count }})</button>
                        <button class="btn btn-danger filter-btn" onclick="filterExperts('Rejected')">Rejected ({{ rejected_experts.count }})</button>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="expertsSearch" placeholder="Maghanap ng eksperto...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Username</th>
                                    <th>Buong Pangalan</th>
                                    <th>Email</th>
                                    <th>Barangay</th>
                                    <th>Telepono</th>
                                    <th>Posisyon</th>
                                    <th>License Number</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="expertsTableBody">
                                {% for expert in experts %}
                                <tr class="expert-row" data-status="{{ expert.status }}">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ expert.username }}</td>
                                    <td>{{ expert.first_name }} {{ expert.middle_name|default:"" }} {{ expert.last_name }}</td>
                                    <td>{{ expert.email }}</td>
                                    <td>{{ expert.barangay }}</td>
                                    <td>{{ expert.phone_number }}</td>
                                    <td>{{ expert.position|default:"N/A" }}</td>
                                    <td>{{ expert.license_number }}</td>
                                    <td>
                                        <span class="badge-custom {% if expert.status == 'Approved' %}bg-success{% elif expert.status == 'Pending' %}bg-warning{% else %}bg-danger{% endif %}">
                                            {{ expert.status }}
                                        </span>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="9" class="text-center">Walang eksperto</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Eksperto: {{ experts.count }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
            
            <!-- Farmers Report -->
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-users"></i> Ulat ng mga Magsasaka</h3>
                    <button class="btn btn-success no-print" onclick="printReport('farmersReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="farmersReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng mga Magsasaka</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="farmersSearch" placeholder="Maghanap ng magsasaka...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Username</th>
                                    <th>Buong Pangalan</th>
                                    <th>Email</th>
                                    <th>Barangay</th>
                                    <th>Telepono</th>
                                    <th>Lawak ng Sakahan (ha)</th>
                                </tr>
                            </thead>
                            <tbody id="farmersTableBody">
                                {% for farmer in farmers %}
                                <tr class="farmer-row">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ farmer.username }}</td>
                                    <td>{{ farmer.first_name }} {{ farmer.middle_name|default:"" }} {{ farmer.last_name }}</td>
                                    <td>{{ farmer.email }}</td>
                                    <td>{{ farmer.barangay }}</td>
                                    <td>{{ farmer.phone_number }}</td>
                                    <td>{{ farmer.farm_size }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">Walang magsasaka</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Magsasaka: {{ farmers.count }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- CONSULTATIONS TAB -->
        <div class="tab-pane fade" id="consultations" role="tabpanel">
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-comments"></i> Ulat ng Konsultasyon</h3>
                    <button class="btn btn-success no-print" onclick="printReport('consultationsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="consultationsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng Konsultasyon</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="filter-buttons no-print">
                        <button class="btn btn-secondary filter-btn active" onclick="filterConsultations('all')">Lahat</button>
                        <button class="btn btn-success filter-btn" onclick="filterConsultations('solved')">Nalutas</button>
                        <button class="btn btn-warning filter-btn" onclick="filterConsultations('unsolved')">Hindi pa Nalutas</button>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="consultationsSearch" placeholder="Maghanap ng konsultasyon...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Eksperto</th>
                                    <th>Posisyon</th>
                                    <th>Barangay ng Eksperto</th>
                                    <th>Magsasaka</th>
                                    <th>Barangay ng Magsasaka</th>
                                    <th>Status</th>
                                    <th>Klasipikasyon</th>
                                    <th>Solusyon</th>
                                    <th>Petsa</th>
                                </tr>
                            </thead>
                            <tbody id="consultationsTableBody">
                                {% for message in consultations %}
                                <tr class="consultation-row" data-status="{% if message.is_solved %}solved{% else %}unsolved{% endif %}">
                                    <td>{{ forloop.counter }}</td>
                                    <td>
                                        {% if message.receiver_expert %}
                                            {{ message.receiver_expert.first_name }} {{ message.receiver_expert.last_name }}
                                        {% elif message.sender_expert %}
                                            {{ message.sender_expert.first_name }} {{ message.sender_expert.last_name }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.receiver_expert %}
                                            {{ message.receiver_expert.position|default:"N/A" }}
                                        {% elif message.sender_expert %}
                                            {{ message.sender_expert.position|default:"N/A" }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.receiver_expert %}
                                            {{ message.receiver_expert.barangay }}
                                        {% elif message.sender_expert %}
                                            {{ message.sender_expert.barangay }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.sender_farmer %}
                                            {{ message.sender_farmer.first_name }} {{ message.sender_farmer.last_name }}
                                        {% elif message.receiver_farmer %}
                                            {{ message.receiver_farmer.first_name }} {{ message.receiver_farmer.last_name }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.sender_farmer %}
                                            {{ message.sender_farmer.barangay }}
                                        {% elif message.receiver_farmer %}
                                            {{ message.receiver_farmer.barangay }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.is_solved %}
                                            <span class="badge-custom bg-success">Nalutas</span>
                                        {% else %}
                                            <span class="badge-custom bg-warning">Pending</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ message.classification|default:"-" }}</td>
                                    <td>{{ message.solution_description|default:"-"|truncatewords:10 }}</td>
                                    <td>{{ message.timestamp|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="10" class="text-center">Walang konsultasyon</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Konsultasyon: {{ total_consultations }} | Nalutas: {{ solved_consultations }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PREDICTIONS TAB -->
        <div class="tab-pane fade" id="predictions" role="tabpanel">
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-bug"></i> Ulat ng Deteksyon ng Peste at Sakit</h3>
                    <button class="btn btn-success no-print" onclick="printReport('predictionsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="predictionsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng Deteksyon ng Peste at Sakit</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="filter-buttons no-print">
                        <button class="btn btn-secondary filter-btn active" onclick="filterPredictions('all')">Lahat</button>
                        <button class="btn btn-success filter-btn" onclick="filterPredictions('Peste')">Peste</button>
                        <button class="btn btn-danger filter-btn" onclick="filterPredictions('Sakit')">Sakit</button>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="predictionsSearch" placeholder="Maghanap ng deteksyon...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Magsasaka</th>
                                    <th>Barangay</th>
                                    <th>Kategorya</th>
                                    <th>Deteksyon</th>
                                    <th>Confidence (%)</th>
                                    <th>Petsa</th>
                                </tr>
                            </thead>
                            <tbody id="predictionsTableBody">
                                {% for pred in predictions %}
                                <tr class="prediction-row" data-category="{{ pred.category }}">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ pred.farmer.first_name }} {{ pred.farmer.last_name }}</td>
                                    <td>{{ pred.farmer.barangay }}</td>
                                    <td>
                                        <span class="badge-custom {% if pred.category == 'Peste' %}bg-success{% elif pred.category == 'Sakit' %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {{ pred.category }}
                                        </span>
                                    </td>
                                    <td>{{ pred.predicted_class }}</td>
                                    <td>{{ pred.confidence|floatformat:2 }}%</td>
                                    <td>{{ pred.uploaded_at|date:"M d, Y - g:i A" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">Walang deteksyon</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Deteksyon: {{ total_predictions }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- POSTS TAB -->
        <div class="tab-pane fade" id="posts" role="tabpanel">
            
            <!-- Expert Posts -->
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-newspaper"></i> Ulat ng mga Post ng Eksperto</h3>
                    <button class="btn btn-success no-print" onclick="printReport('expertPostsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="expertPostsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng mga Post ng Eksperto</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="expertPostsSearch" placeholder="Maghanap ng post...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Eksperto</th>
                                    <th>Pamagat</th>
                                    <th>Caption</th>
                                    <th>Upvotes</th>
                                    <th>Comments</th>
                                    <th>Petsa</th>
                                </tr>
                            </thead>
                            <tbody id="expertPostsTableBody">
                                {% for post in expert_posts %}
                                <tr class="expert-post-row">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ post.expert.first_name }} {{ post.expert.last_name }}</td>
                                    <td>{{ post.title }}</td>
                                    <td>{{ post.caption|truncatewords:15 }}</td>
                                    <td><span class="badge bg-primary">{{ post.upvotes_count }}</span></td>
                                    <td><span class="badge bg-info">{{ post.comments_count }}</span></td>
                                    <td>{{ post.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">Walang post</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Post ng Eksperto: {{ total_expert_posts }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
            
            <!-- Farmer Posts -->
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-newspaper"></i> Ulat ng mga Post ng Magsasaka</h3>
                    <button class="btn btn-success no-print" onclick="printReport('farmerPostsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="farmerPostsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng mga Post ng Magsasaka</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="farmerPostsSearch" placeholder="Maghanap ng post...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Magsasaka</th>
                                    <th>Pamagat</th>
                                    <th>Caption</th>
                                    <th>Upvotes</th>
                                    <th>Comments</th>
                                    <th>Petsa</th>
                                </tr>
                            </thead>
                            <tbody id="farmerPostsTableBody">
                                {% for post in farmer_posts %}
                                <tr class="farmer-post-row">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ post.farmer.first_name }} {{ post.farmer.last_name }}</td>
                                    <td>{{ post.title }}</td>
                                    <td>{{ post.caption|truncatewords:15 }}</td>
                                    <td><span class="badge bg-primary">{{ post.upvotes_count }}</span></td>
                                    <td><span class="badge bg-info">{{ post.comments_count }}</span></td>
                                    <td>{{ post.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">Walang post</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Post ng Magsasaka: {{ total_farmer_posts }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- LIBRARY TAB -->
        <div class="tab-pane fade" id="library" role="tabpanel">
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-book"></i> Ulat ng Aklatan</h3>
                    <button class="btn btn-success no-print" onclick="printReport('libraryReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="libraryReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng Aklatan</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="librarySearch" placeholder="Maghanap sa aklatan...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Paksa</th>
                                    <th>Deskripsyon</th>
                                    <th>Petsa ng Pagdagdag</th>
                                </tr>
                            </thead>
                            <tbody id="libraryTableBody">
                                {% for entry in library_entries %}
                                <tr class="library-row">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ entry.paksa }}</td>
                                    <td>{{ entry.deskripsyon|truncatewords:20 }}</td>
                                    <td>{{ entry.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center">Walang entry sa aklatan</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Entry: {{ library_entries.count }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</div>

<!-- Modal for Viewing Proof of Expertise -->
<div class="modal fade" id="proofModal" tabindex="-1" aria-labelledby="proofModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="proofModalLabel">Proof of Expertise</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div id="proofContent">
                    <!-- File preview will be loaded here dynamically -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Kumpirmasyon</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Sigurado ka bang gusto mong baguhin ang status ng ekspertong ito?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kanselahin</button>
                <button type="button" class="btn btn-success" id="confirmAction">Oo, Kumpirmahin</button>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="successModalLabel">Matagumpay!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="successMessage">Status ng eksperto ay na-update na!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Sige</button>
            </div>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="errorModalLabel">Error!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="errorMessage">May error sa pag-update ng status. Pakisubukan muli.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Sige</button>
            </div>
        </div>
    </div>
</div>

<script>
// Professional Print Function for Admin Reports
function printReport(reportId) {
    const printSection = document.getElementById(reportId);
    if (!printSection) {
        alert('Report section not found!');
        return;
    }

    // Get current date and time in Filipino format
    const now = new Date();
    const formattedDate = now.toLocaleString("tl-PH", {
        weekday: "long",
        year: "numeric", 
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        hour12: true
    });

    // Create a new window for printing
    const printWindow = window.open('', '_blank', 'width=1000,height=600');
    
    // Professional print template - using proper string concatenation
    const printHTML = `<!DOCTYPE html>
<html>
<head>
    <title>Admin Report - ${getReportTitle(reportId)}</title>
    <style>
        body { 
            font-family: 'Times New Roman', serif; 
            margin: 25px; 
            font-size: 12px; 
            line-height: 1.4; 
            color: #000; 
            background: white;
        }
        
        /* Professional letterhead */
        .print-letterhead { 
            text-align: center; 
            margin-bottom: 30px; 
            padding-bottom: 20px; 
            border-bottom: 3px solid #000; 
        }
        .print-letterhead h1 { 
            font-size: 24px; 
            font-weight: bold; 
            margin-bottom: 8px; 
            letter-spacing: 2px; 
            color: #000;
        }
        .print-letterhead h2 { 
            font-size: 18px; 
            font-weight: bold; 
            margin: 5px 0; 
        }
        .print-letterhead p { 
            font-size: 14px; 
            margin: 3px 0; 
            color: #666;
        }
        
        /* Report info */
        .report-info { 
            border: 2px solid #000; 
            padding: 15px; 
            margin: 20px 0 30px 0; 
            background-color: #f8f9fa; 
        }
        .report-info p { 
            font-size: 12px; 
            margin-bottom: 5px; 
            font-weight: normal; 
        }
        
        /* Professional table styling */
        .table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
            border: 2px solid #000; 
            font-size: 10px;
        }
        .table th, .table td { 
            padding: 8px 6px; 
            border: 1px solid #000; 
            text-align: left; 
            vertical-align: top; 
        }
        .table th { 
            background-color: #e9ecef; 
            font-weight: bold; 
            text-align: center; 
            font-size: 11px;
        }
        .table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        /* Footer */
        .print-footer { 
            margin-top: 30px; 
            padding-top: 20px; 
            border-top: 2px solid #000; 
            text-align: center; 
        }
        .print-footer p { 
            font-size: 11px; 
            margin-bottom: 3px; 
        }
        
        /* Hide non-essential elements */
        .no-print, .btn, .filter-buttons, .search-box { 
            display: none !important; 
        }
        
        /* Ensure badges print properly */
        .badge {
            background-color: transparent !important;
            color: #000 !important;
            border: 1px solid #000;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: normal;
        }
        
        @media print {
            body { margin: 15px; }
            .table { font-size: 9px; }
            .table th, .table td { padding: 6px 4px; }
        }
    </style>
</head>
<body>
    <div class="print-letterhead">
        <h1>MUNICIPAL AGRICULTURE OFFICE</h1>
        <h2>Victoria, Oriental Mindoro</h2>
        <p>San Gelacio, Victoria, Oriental Mindoro</p>
        <h3>${getReportTitle(reportId)}</h3>
    </div>
    
    <div class="report-info">
        <p><strong>Petsa ng Ulat:</strong> ${formattedDate}</p>
        <p><strong>Uri ng Ulat:</strong> ${getReportType(reportId)}</p>
        ${getReportStatistics(reportId)}
    </div>
    
    <div class="table-responsive">
        ${extractTableContent(printSection.innerHTML)}
    </div>
    
    <div class="print-footer">
        <p><strong>Municipal Agriculture Office - Victoria, Oriental Mindoro</strong></p>
        <p>AgriExpert System © 2025</p>
        <p>Pahina 1 ng 1</p>
    </div>
    
    <script>
        window.onload = function() {
            window.print();
            setTimeout(function() {
                window.close();
            }, 500);
        };
    <` + `/script>
</body>
</html>`;
    
    printWindow.document.write(printHTML);
    printWindow.document.close();
}

// Helper function to get report title
function getReportTitle(reportId) {
    const titles = {
        'expertsReport': 'ULAT NG MGA EKSPERTO',
        'farmersReport': 'ULAT NG MGA MAGSASAKA',
        'consultationsReport': 'ULAT NG MGA KONSULTASYON',
        'predictionsReport': 'ULAT NG DETEKSYON NG PESTE AT SAKIT',
        'expertPostsReport': 'ULAT NG MGA POST NG EKSPERTO',
        'farmerPostsReport': 'ULAT NG MGA POST NG MAGSASAKA',
        'libraryReport': 'ULAT NG AKLATAN'
    };
    return titles[reportId] || 'ADMIN REPORT';
}

// Helper function to get report type
function getReportType(reportId) {
    const types = {
        'expertsReport': 'Demograpiko - Mga Eksperto',
        'farmersReport': 'Demograpiko - Mga Magsasaka',
        'consultationsReport': 'Konsultasyon',
        'predictionsReport': 'Deteksyon at Analytics',
        'expertPostsReport': 'Mga Post - Eksperto',
        'farmerPostsReport': 'Mga Post - Magsasaka',
        'libraryReport': 'Aklatan at Kaalaman'
    };
    return types[reportId] || 'Sistema Report';
}

// Helper function to get report statistics
function getReportStatistics(reportId) {
    const section = document.getElementById(reportId);
    if (!section) return '';
    
    let stats = '';
    const table = section.querySelector('table');
    if (table) {
        const rowCount = table.querySelectorAll('tbody tr:not([style*="display: none"])').length;
        stats += '<p><strong>Kabuuang Bilang ng Records:</strong> ' + rowCount + '</p>';
    }
    
    // Add specific statistics based on report type
    if (reportId === 'consultationsReport') {
        const solvedCount = section.querySelectorAll('.consultation-row[data-status="solved"]:not([style*="display: none"])').length;
        stats += '<p><strong>Nalutas na Konsultasyon:</strong> ' + solvedCount + '</p>';
    }
    
    if (reportId === 'expertsReport') {
        const approvedCount = section.querySelectorAll('.expert-row[data-status="Approved"]:not([style*="display: none"])').length;
        const pendingCount = section.querySelectorAll('.expert-row[data-status="Pending"]:not([style*="display: none"])').length;
        stats += '<p><strong>Approved na Eksperto:</strong> ' + approvedCount + '</p>';
        stats += '<p><strong>Pending na Eksperto:</strong> ' + pendingCount + '</p>';
    }
    
    return stats;
}

// Extract clean table content for printing
function extractTableContent(htmlContent) {
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = htmlContent;
    
    // Get the table
    const table = tempDiv.querySelector('table');
    if (!table) return '<p>Walang data na maipakita.</p>';
    
    // Create a clean table for printing
    let cleanTable = '<table class="table">';
    
    // Add header
    const headerRows = table.querySelectorAll('thead tr');
    headerRows.forEach(headerRow => {
        cleanTable += '<thead><tr>';
        headerRow.querySelectorAll('th').forEach(th => {
            // Remove any HTML and get clean text
            const text = th.textContent.replace(/[\\n\\t]/g, '').trim();
            cleanTable += '<th>' + text + '</th>';
        });
        cleanTable += '</tr></thead>';
    });
    
    // Add body with only visible rows
    cleanTable += '<tbody>';
    const visibleRows = table.querySelectorAll('tbody tr:not([style*="display: none"])');
    
    if (visibleRows.length === 0) {
        const colCount = table.querySelectorAll('thead th').length;
        cleanTable += '<tr><td colspan="' + colCount + '" style="text-align: center;">Walang data na natagpuan</td></tr>';
    } else {
        visibleRows.forEach(row => {
            if (row.cells.length > 1) { // Skip empty rows
                cleanTable += '<tr>';
                Array.from(row.cells).forEach(cell => {
                    // Clean cell content - remove HTML tags, get plain text
                    let cellText = cell.textContent || cell.innerText || '';
                    cellText = cellText.replace(/[\\n\\t]/g, '').trim();
                    
                    // Handle badges - convert to plain text
                    const badge = cell.querySelector('.badge, .badge-custom');
                    if (badge) {
                        cellText = badge.textContent.trim();
                    }
                    
                    cleanTable += '<td>' + cellText + '</td>';
                });
                cleanTable += '</tr>';
            }
        });
    }
    
    cleanTable += '</tbody></table>';
    return cleanTable;
}

// Enhanced search functionality to work with printing
document.addEventListener('DOMContentLoaded', function() {
    // Update all search functions to work with the new print system
    const searchConfigs = [
        { searchId: 'expertsSearch', tableId: 'expertsTableBody' },
        { searchId: 'farmersSearch', tableId: 'farmersTableBody' },
        { searchId: 'consultationsSearch', tableId: 'consultationsTableBody' },
        { searchId: 'predictionsSearch', tableId: 'predictionsTableBody' },
        { searchId: 'expertPostsSearch', tableId: 'expertPostsTableBody' },
        { searchId: 'farmerPostsSearch', tableId: 'farmerPostsTableBody' },
        { searchId: 'librarySearch', tableId: 'libraryTableBody' },
        { searchId: 'expertsManagementSearch', tableId: 'expertsManagementTableBody' },
        { searchId: 'farmersManagementSearch', tableId: 'farmersManagementTableBody' }
    ];
    
    searchConfigs.forEach(config => {
        const searchInput = document.getElementById(config.searchId);
        const tableBody = document.getElementById(config.tableId);
        
        if (searchInput && tableBody) {
            searchInput.addEventListener('keyup', function() {
                const filter = this.value.toLowerCase();
                const rows = tableBody.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(filter) ? '' : 'none';
                });
            });
        }
    });
});

// Update Expert Status with UI Confirmation
let currentExpertId = null;
let currentStatus = null;

function updateExpertStatus(expertId, status) {
    currentExpertId = expertId;
    currentStatus = status;
    
    const statusText = status.toLowerCase();
    const expertName = document.querySelector('.expert-management-row[data-status] td:nth-child(4)').textContent.trim();
    
    document.getElementById('confirmationMessage').innerHTML = 
        'Sigurado ka bang gusto mong <strong>' + statusText + '</strong> ang ekspertong:<br><strong>"' + expertName + '"</strong>?';
    
    const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
    confirmationModal.show();
}

// Confirm action
document.getElementById('confirmAction').addEventListener('click', function() {
    if (currentExpertId && currentStatus) {
        fetch('/adminako/update_expert_status/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                expert_id: currentExpertId,
                status: currentStatus
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Close confirmation modal
                const confirmationModal = bootstrap.Modal.getInstance(document.getElementById('confirmationModal'));
                confirmationModal.hide();
                
                // Show success modal
                document.getElementById('successMessage').textContent = 
                    'Status ng eksperto ay na-update na sa ' + currentStatus;
                const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                successModal.show();
                
                // Reload after success modal is closed
                document.getElementById('successModal').addEventListener('hidden.bs.modal', function () {
                    location.reload();
                });
            } else {
                // Close confirmation modal
                const confirmationModal = bootstrap.Modal.getInstance(document.getElementById('confirmationModal'));
                confirmationModal.hide();
                
                // Show error modal
                document.getElementById('errorMessage').textContent = 
                    'Error sa pag-update ng status: ' + (data.error || 'Unknown error');
                const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
                errorModal.show();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            // Close confirmation modal
            const confirmationModal = bootstrap.Modal.getInstance(document.getElementById('confirmationModal'));
            confirmationModal.hide();
            
            // Show error modal
            document.getElementById('errorMessage').textContent = 'Error sa pag-update ng status';
            const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
            errorModal.show();
        });
    }
});

// CSRF token helper function
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Filter Management Experts
function filterManagementExperts(status) {
    const rows = document.querySelectorAll('.expert-management-row');
    const buttons = document.querySelectorAll('#users .filter-buttons .filter-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    rows.forEach(row => {
        if (status === 'all' || row.dataset.status === status) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// Filter Experts
function filterExperts(status) {
    const rows = document.querySelectorAll('.expert-row');
    const buttons = document.querySelectorAll('#demographics .filter-buttons .filter-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    rows.forEach(row => {
        if (status === 'all' || row.dataset.status === status) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// Filter Consultations
function filterConsultations(status) {
    const rows = document.querySelectorAll('.consultation-row');
    const buttons = document.querySelectorAll('#consultations .filter-buttons .filter-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    rows.forEach(row => {
        if (status === 'all' || row.dataset.status === status) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// Filter Predictions
function filterPredictions(category) {
    const rows = document.querySelectorAll('.prediction-row');
    const buttons = document.querySelectorAll('#predictions .filter-buttons .filter-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    rows.forEach(row => {
        if (category === 'all' || row.dataset.category === category) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// File Preview Function
function previewFile(fileUrl) {
    console.log("Opening file:", fileUrl);
    let proofContent = document.getElementById("proofContent");
    proofContent.innerHTML = "";

    if (!fileUrl) {
        alert("No file available!");
        return;
    }

    let fileExtension = fileUrl.split('.').pop().toLowerCase();

    if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) {
        proofContent.innerHTML = '<img src="' + fileUrl + '" class="img-fluid" alt="Proof of Expertise">';
    } else if (fileExtension === 'pdf') {
        proofContent.innerHTML = '<iframe src="' + fileUrl + '" width="100%" height="600px" style="border:none;"></iframe>';
    } else if (['doc', 'docx'].includes(fileExtension)) {
        let convertUrl = '/convert_docx_to_pdf/?file_url=' + encodeURIComponent(fileUrl);

        fetch(convertUrl)
        .then(response => response.json())
        .then(data => {
            if (data.pdf_url) {
                console.log("Using PDF URL:", data.pdf_url);
                proofContent.innerHTML = '<iframe src="' + data.pdf_url + '" width="100%" height="600px" style="border:none;"></iframe>';
            } else {
                proofContent.innerHTML = '<p class="text-danger">Could not preview this document. <a href="' + fileUrl + '" target="_blank">Download here</a></p>';
            }
        })
        .catch(error => {
            console.error("Error fetching PDF:", error);
            proofContent.innerHTML = '<p class="text-danger">Could not preview this document. <a href="' + fileUrl + '" target="_blank">Download here</a></p>';
        });
    } else {
        proofContent.innerHTML = '<p class="text-danger">File format not supported. <a href="' + fileUrl + '" target="_blank">Download here</a></p>';
    }

    let proofModal = new bootstrap.Modal(document.getElementById('proofModal'));
    proofModal.show();
}
</script>

{% endblock %}
{% comment %} {% extends 'adminako/base_admin.html' %}
{% load static %}

{% block content %}
<style>
    /* Print Styles */
    .print-header, .print-footer {
        display: none;
    }
    
    @media print {
        body * {
            visibility: hidden;
        }
        
        .print-section, .print-section * {
            visibility: visible;
        }
        
        .print-section {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }
        
        .print-header, .print-footer {
            display: block;
        }
        
        .no-print {
            display: none !important;
        }
        
        .btn, .nav-tabs, .filter-buttons {
            display: none !important;
        }
    }
    
    .print-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #28a745;
    }
    
    .print-header h2 {
        color: #28a745;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .print-header h3 {
        color: #333;
        font-size: 1.2rem;
        margin: 5px 0;
    }
    
    .print-header p {
        color: #666;
        margin: 3px 0;
    }
    
    .print-footer {
        margin-top: 50px;
        padding-top: 20px;
        border-top: 2px solid #ddd;
        text-align: center;
        color: #666;
    }
    
    .report-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 25px;
        margin-bottom: 30px;
    }
    
    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .report-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
    }
    
    .filter-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 15px;
    }
    
    .filter-btn {
        padding: 8px 16px;
        border-radius: 5px;
        border: 2px solid transparent;
        transition: all 0.3s;
    }
    
    .filter-btn.active {
        border-width: 2px;
        font-weight: bold;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    
    .search-box {
        margin-bottom: 20px;
    }
    
    .search-box input {
        border-radius: 8px;
        padding: 12px;
        border: 2px solid #e0e0e0;
    }
    
    .search-box input:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
    }
    
    .stat-card.green {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .stat-card.blue {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .stat-card.orange {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    
    .stat-card.red {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .table-responsive {
        border-radius: 8px;
        overflow: hidden;
    }
    
    .table {
        margin-bottom: 0;
    }
    
    .table thead th {
        background-color: #28a745;
        color: white;
        font-weight: 600;
        border: none;
        padding: 15px 10px;
    }
    
    .table tbody tr:hover {
        background-color: #f8f9fa;
    }
    
    .badge-custom {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }
    
    .nav-tabs {
        border-bottom: 3px solid #28a745;
        margin-bottom: 30px;
    }
    
    .nav-tabs .nav-link {
        color: #666;
        font-weight: 600;
        border: none;
        padding: 12px 24px;
    }
    
    .nav-tabs .nav-link.active {
        color: #28a745;
        background-color: #f8f9fa;
        border-bottom: 3px solid #28a745;
    }
</style>

<div class="container-fluid mt-4">
     Page Header 
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-center fw-bold mb-2" style="color: #28a745;">
                <i class="fas fa-file-alt"></i> Mga Ulat ng Sistema
            </h1>
            <p class="text-center text-muted">Municipal Agriculture Office of Victoria, Oriental Mindoro</p>
        </div>
    </div>
    
     Statistics Overview 
    <div class="stats-grid no-print">
        <div class="stat-card green">
            <i class="fas fa-users fa-2x"></i>
            <div class="stat-number">{{ total_farmers }}</div>
            <div class="stat-label">Kabuuang Magsasaka</div>
        </div>
        <div class="stat-card blue">
            <i class="fas fa-user-tie fa-2x"></i>
            <div class="stat-number">{{ total_experts }}</div>
            <div class="stat-label">Kabuuang Eksperto</div>
        </div>
        <div class="stat-card orange">
            <i class="fas fa-comments fa-2x"></i>
            <div class="stat-number">{{ total_consultations }}</div>
            <div class="stat-label">Kabuuang Konsultasyon</div>
        </div>
        <div class="stat-card red">
            <i class="fas fa-bug fa-2x"></i>
            <div class="stat-number">{{ total_predictions }}</div>
            <div class="stat-label">Kabuuang Deteksyon</div>
        </div>
    </div>
    
     Navigation Tabs 
    <ul class="nav nav-tabs no-print" id="reportTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="demographics-tab" data-bs-toggle="tab" data-bs-target="#demographics" type="button">
                <i class="fas fa-users"></i> Demograpiko
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="consultations-tab" data-bs-toggle="tab" data-bs-target="#consultations" type="button">
                <i class="fas fa-comments"></i> Konsultasyon
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="predictions-tab" data-bs-toggle="tab" data-bs-target="#predictions" type="button">
                <i class="fas fa-bug"></i> Deteksyon
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="posts-tab" data-bs-toggle="tab" data-bs-target="#posts" type="button">
                <i class="fas fa-newspaper"></i> Mga Post
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="library-tab" data-bs-toggle="tab" data-bs-target="#library" type="button">
                <i class="fas fa-book"></i> Aklatan
            </button>
        </li>
    </ul>
    
     Tab Content 
    <div class="tab-content" id="reportTabsContent">
        
         DEMOGRAPHICS TAB 
        <div class="tab-pane fade show active" id="demographics" role="tabpanel">
            
             Experts Report 
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-user-tie"></i> Ulat ng mga Eksperto</h3>
                    <button class="btn btn-success no-print" onclick="printReport('expertsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="expertsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng mga Eksperto</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="filter-buttons no-print">
                        <button class="btn btn-secondary filter-btn active" onclick="filterExperts('all')">Lahat ({{ experts.count }})</button>
                        <button class="btn btn-warning filter-btn" onclick="filterExperts('Pending')">Pending ({{ pending_experts.count }})</button>
                        <button class="btn btn-success filter-btn" onclick="filterExperts('Approved')">Approved ({{ approved_experts.count }})</button>
                        <button class="btn btn-danger filter-btn" onclick="filterExperts('Rejected')">Rejected ({{ rejected_experts.count }})</button>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="expertsSearch" placeholder="Maghanap ng eksperto...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Username</th>
                                    <th>Buong Pangalan</th>
                                    <th>Email</th>
                                    <th>Barangay</th>
                                    <th>Telepono</th>
                                    <th>Posisyon</th>
                                    <th>License Number</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="expertsTableBody">
                                {% for expert in experts %}
                                <tr class="expert-row" data-status="{{ expert.status }}">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ expert.username }}</td>
                                    <td>{{ expert.first_name }} {{ expert.middle_name|default:"" }} {{ expert.last_name }}</td>
                                    <td>{{ expert.email }}</td>
                                    <td>{{ expert.barangay }}</td>
                                    <td>{{ expert.phone_number }}</td>
                                    <td>{{ expert.position|default:"N/A" }}</td>
                                    <td>{{ expert.license_number }}</td>
                                    <td>
                                        <span class="badge-custom {% if expert.status == 'Approved' %}bg-success{% elif expert.status == 'Pending' %}bg-warning{% else %}bg-danger{% endif %}">
                                            {{ expert.status }}
                                        </span>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="9" class="text-center">Walang eksperto</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Eksperto: {{ experts.count }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
            
             Farmers Report 
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-users"></i> Ulat ng mga Magsasaka</h3>
                    <button class="btn btn-success no-print" onclick="printReport('farmersReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="farmersReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng mga Magsasaka</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="farmersSearch" placeholder="Maghanap ng magsasaka...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Username</th>
                                    <th>Buong Pangalan</th>
                                    <th>Email</th>
                                    <th>Barangay</th>
                                    <th>Telepono</th>
                                    <th>Lawak ng Sakahan (ha)</th>
                                </tr>
                            </thead>
                            <tbody id="farmersTableBody">
                                {% for farmer in farmers %}
                                <tr class="farmer-row">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ farmer.username }}</td>
                                    <td>{{ farmer.first_name }} {{ farmer.middle_name|default:"" }} {{ farmer.last_name }}</td>
                                    <td>{{ farmer.email }}</td>
                                    <td>{{ farmer.barangay }}</td>
                                    <td>{{ farmer.phone_number }}</td>
                                    <td>{{ farmer.farm_size }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">Walang magsasaka</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Magsasaka: {{ farmers.count }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
            
        </div>
        
         CONSULTATIONS TAB 
        <div class="tab-pane fade" id="consultations" role="tabpanel">
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-comments"></i> Ulat ng Konsultasyon</h3>
                    <button class="btn btn-success no-print" onclick="printReport('consultationsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="consultationsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng Konsultasyon</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="filter-buttons no-print">
                        <button class="btn btn-secondary filter-btn active" onclick="filterConsultations('all')">Lahat</button>
                        <button class="btn btn-success filter-btn" onclick="filterConsultations('solved')">Nalutas</button>
                        <button class="btn btn-warning filter-btn" onclick="filterConsultations('unsolved')">Hindi pa Nalutas</button>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="consultationsSearch" placeholder="Maghanap ng konsultasyon...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Eksperto</th>
                                    <th>Posisyon</th>
                                    <th>Barangay ng Eksperto</th>
                                    <th>Magsasaka</th>
                                    <th>Barangay ng Magsasaka</th>
                                    <th>Status</th>
                                    <th>Klasipikasyon</th>
                                    <th>Solusyon</th>
                                    <th>Petsa</th>
                                </tr>
                            </thead>
                            <tbody id="consultationsTableBody">
                                {% for message in consultations %}
                                <tr class="consultation-row" data-status="{% if message.is_solved %}solved{% else %}unsolved{% endif %}">
                                    <td>{{ forloop.counter }}</td>
                                    <td>
                                        {% if message.receiver_expert %}
                                            {{ message.receiver_expert.first_name }} {{ message.receiver_expert.last_name }}
                                        {% elif message.sender_expert %}
                                            {{ message.sender_expert.first_name }} {{ message.sender_expert.last_name }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.receiver_expert %}
                                            {{ message.receiver_expert.position|default:"N/A" }}
                                        {% elif message.sender_expert %}
                                            {{ message.sender_expert.position|default:"N/A" }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.receiver_expert %}
                                            {{ message.receiver_expert.barangay }}
                                        {% elif message.sender_expert %}
                                            {{ message.sender_expert.barangay }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.sender_farmer %}
                                            {{ message.sender_farmer.first_name }} {{ message.sender_farmer.last_name }}
                                        {% elif message.receiver_farmer %}
                                            {{ message.receiver_farmer.first_name }} {{ message.receiver_farmer.last_name }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.sender_farmer %}
                                            {{ message.sender_farmer.barangay }}
                                        {% elif message.receiver_farmer %}
                                            {{ message.receiver_farmer.barangay }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if message.is_solved %}
                                            <span class="badge-custom bg-success">Nalutas</span>
                                        {% else %}
                                            <span class="badge-custom bg-warning">Pending</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ message.classification|default:"-" }}</td>
                                    <td>{{ message.solution_description|default:"-"|truncatewords:10 }}</td>
                                    <td>{{ message.timestamp|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="10" class="text-center">Walang konsultasyon</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Konsultasyon: {{ total_consultations }} | Nalutas: {{ solved_consultations }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
        </div>
        
         PREDICTIONS TAB 
        <div class="tab-pane fade" id="predictions" role="tabpanel">
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-bug"></i> Ulat ng Deteksyon ng Peste at Sakit</h3>
                    <button class="btn btn-success no-print" onclick="printReport('predictionsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="predictionsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng Deteksyon ng Peste at Sakit</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="filter-buttons no-print">
                        <button class="btn btn-secondary filter-btn active" onclick="filterPredictions('all')">Lahat</button>
                        <button class="btn btn-success filter-btn" onclick="filterPredictions('Peste')">Peste</button>
                        <button class="btn btn-danger filter-btn" onclick="filterPredictions('Sakit')">Sakit</button>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="predictionsSearch" placeholder="Maghanap ng deteksyon...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Magsasaka</th>
                                    <th>Barangay</th>
                                    <th>Kategorya</th>
                                    <th>Deteksyon</th>
                                    <th>Confidence (%)</th>
                                    <th>Petsa</th>
                                </tr>
                            </thead>
                            <tbody id="predictionsTableBody">
                                {% for pred in predictions %}
                                <tr class="prediction-row" data-category="{{ pred.category }}">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ pred.farmer.first_name }} {{ pred.farmer.last_name }}</td>
                                    <td>{{ pred.farmer.barangay }}</td>
                                    <td>
                                        <span class="badge-custom {% if pred.category == 'Peste' %}bg-success{% elif pred.category == 'Sakit' %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {{ pred.category }}
                                        </span>
                                    </td>
                                    <td>{{ pred.predicted_class }}</td>
                                    <td>{{ pred.confidence|floatformat:2 }}%</td>
                                    <td>{{ pred.uploaded_at|date:"M d, Y - g:i A" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">Walang deteksyon</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Deteksyon: {{ total_predictions }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
        </div>
        
         POSTS TAB 
        <div class="tab-pane fade" id="posts" role="tabpanel">
            
             Expert Posts 
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-newspaper"></i> Ulat ng mga Post ng Eksperto</h3>
                    <button class="btn btn-success no-print" onclick="printReport('expertPostsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="expertPostsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng mga Post ng Eksperto</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="expertPostsSearch" placeholder="Maghanap ng post...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Eksperto</th>
                                    <th>Pamagat</th>
                                    <th>Caption</th>
                                    <th>Upvotes</th>
                                    <th>Comments</th>
                                    <th>Petsa</th>
                                </tr>
                            </thead>
                            <tbody id="expertPostsTableBody">
                                {% for post in expert_posts %}
                                <tr class="expert-post-row">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ post.expert.first_name }} {{ post.expert.last_name }}</td>
                                    <td>{{ post.title }}</td>
                                    <td>{{ post.caption|truncatewords:15 }}</td>
                                    <td><span class="badge bg-primary">{{ post.upvotes_count }}</span></td>
                                    <td><span class="badge bg-info">{{ post.comments_count }}</span></td>
                                    <td>{{ post.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">Walang post</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Post ng Eksperto: {{ total_expert_posts }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
            
             Farmer Posts 
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-newspaper"></i> Ulat ng mga Post ng Magsasaka</h3>
                    <button class="btn btn-success no-print" onclick="printReport('farmerPostsReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="farmerPostsReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng mga Post ng Magsasaka</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="farmerPostsSearch" placeholder="Maghanap ng post...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Magsasaka</th>
                                    <th>Pamagat</th>
                                    <th>Caption</th>
                                    <th>Upvotes</th>
                                    <th>Comments</th>
                                    <th>Petsa</th>
                                </tr>
                            </thead>
                            <tbody id="farmerPostsTableBody">
                                {% for post in farmer_posts %}
                                <tr class="farmer-post-row">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ post.farmer.first_name }} {{ post.farmer.last_name }}</td>
                                    <td>{{ post.title }}</td>
                                    <td>{{ post.caption|truncatewords:15 }}</td>
                                    <td><span class="badge bg-primary">{{ post.upvotes_count }}</span></td>
                                    <td><span class="badge bg-info">{{ post.comments_count }}</span></td>
                                    <td>{{ post.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">Walang post</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Post ng Magsasaka: {{ total_farmer_posts }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
            
        </div>
        
         LIBRARY TAB 
        <div class="tab-pane fade" id="library" role="tabpanel">
            <div class="report-card">
                <div class="report-header">
                    <h3 class="report-title"><i class="fas fa-book"></i> Ulat ng Aklatan</h3>
                    <button class="btn btn-success no-print" onclick="printReport('libraryReport')">
                        <i class="fas fa-print"></i> I-print
                    </button>
                </div>
                
                <div id="libraryReport" class="print-section">
                    <div class="print-header">
                        <h2>Ulat ng Aklatan</h2>
                        <h3>Municipal Agriculture Office</h3>
                        <p>Municipality of Victoria, Oriental Mindoro</p>
                        <p>San Gelacio, Victoria, Oriental Mindoro</p>
                        <p><strong>Petsa ng Ulat:</strong> {{ report_date|date:"F d, Y - g:i A" }}</p>
                    </div>
                    
                    <div class="search-box no-print">
                        <input type="text" class="form-control" id="librarySearch" placeholder="Maghanap sa aklatan...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Paksa</th>
                                    <th>Deskripsyon</th>
                                    <th>Petsa ng Pagdagdag</th>
                                </tr>
                            </thead>
                            <tbody id="libraryTableBody">
                                {% for entry in library_entries %}
                                <tr class="library-row">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ entry.paksa }}</td>
                                    <td>{{ entry.deskripsyon|truncatewords:20 }}</td>
                                    <td>{{ entry.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center">Walang entry sa aklatan</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="print-footer">
                        <p>Kabuuang Entry: {{ library_entries.count }}</p>
                        <p>AgriExpert System © 2025</p>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</div>

<script>
// Print function
function printReport(reportId) {
    const printSection = document.getElementById(reportId);
    const originalContents = document.body.innerHTML;
    const printContents = printSection.innerHTML;
    
    document.body.innerHTML = printContents;
    window.print();
    document.body.innerHTML = originalContents;
    location.reload(); // Reload to restore functionality
}

// Filter Experts
function filterExperts(status) {
    const rows = document.querySelectorAll('.expert-row');
    const buttons = document.querySelectorAll('#demographics .filter-buttons .filter-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    rows.forEach(row => {
        if (status === 'all' || row.dataset.status === status) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// Filter Consultations
function filterConsultations(status) {
    const rows = document.querySelectorAll('.consultation-row');
    const buttons = document.querySelectorAll('#consultations .filter-buttons .filter-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    rows.forEach(row => {
        if (status === 'all' || row.dataset.status === status) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// Filter Predictions
function filterPredictions(category) {
    const rows = document.querySelectorAll('.prediction-row');
    const buttons = document.querySelectorAll('#predictions .filter-buttons .filter-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    rows.forEach(row => {
        if (category === 'all' || row.dataset.category === category) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// Search functionality
document.addEventListener('DOMContentLoaded', function() {
    // Experts search
    const expertsSearch = document.getElementById('expertsSearch');
    if (expertsSearch) {
        expertsSearch.addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('.expert-row');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    }
    
    // Farmers search
    const farmersSearch = document.getElementById('farmersSearch');
    if (farmersSearch) {
        farmersSearch.addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('.farmer-row');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    }
    
    // Consultations search
    const consultationsSearch = document.getElementById('consultationsSearch');
    if (consultationsSearch) {
        consultationsSearch.addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('.consultation-row');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    }
    
    // Predictions search
    const predictionsSearch = document.getElementById('predictionsSearch');
    if (predictionsSearch) {
        predictionsSearch.addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('.prediction-row');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    }
    
    // Expert Posts search
    const expertPostsSearch = document.getElementById('expertPostsSearch');
    if (expertPostsSearch) {
        expertPostsSearch.addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('.expert-post-row');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    }
    
    // Farmer Posts search
    const farmerPostsSearch = document.getElementById('farmerPostsSearch');
    if (farmerPostsSearch) {
        farmerPostsSearch.addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('.farmer-post-row');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    }
    
    // Library search
    const librarySearch = document.getElementById('librarySearch');
    if (librarySearch) {
        librarySearch.addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('.library-row');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    }
});
</script>

{% endblock %} {% endcomment %}


{% comment %} {% extends 'adminako/base_admin.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">Mga Ulat sa Demograpiko</h2>
    <!-- Role Selection Buttons -->
    <div class="text-center mb-3">
        <button class="btn btn-success" onclick="showTable('experts')">Eksperto</button>
        <button class="btn btn-primary" onclick="showTable('farmers')">Magsasaka</button>
    </div>
    <!-- Search Bar for Eksperto & Magsasaka -->
    <div id="table-search-bar" class="mb-3" style="display: none;">
        <input type="text" id="reportSearchInput" class="form-control" placeholder="Maghanap sa eksperto o magsasaka...">
    </div>

    <!-- Eksperto Status Filters -->
    <div id="expert-filters" class="text-center mb-3" style="display: none;">
        <button class="btn btn-secondary" onclick="showAllExperts()">Lahat</button>
        <button class="btn btn-warning" onclick="filterTable('Pending')">Pending</button>
        <button class="btn btn-success" onclick="filterTable('Approved')">Approved</button>
        <button class="btn btn-danger" onclick="filterTable('Rejected')">Rejected</button>
    </div>

<!-- Eksperto Table -->
<div id="experts-table" style="display: none;">
    <div class="d-flex justify-content-between align-items-center">
        <h4 class="text-center">Eksperto Table</h4>
        <a href="{% url 'generate_expert_pdf' %}" class="btn btn-primary">
            <i class="fas fa-file-pdf"></i> I-print ang Ulat ng Eksperto
        </a>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>First Name</th>
                    <th>Middle Name</th>
                    <th>Last Name</th>
                    <th>Barangay</th>
                    <th>Phone</th>
                    <th>Profile</th>
                    <th>Role</th>
                    <th>Proof of Expertise</th>
                    <th>License Number</th>
                    <th>Position</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for expert in experts %}
                <tr class="expert-row" data-status="{{ expert.status }}">
                    <td>{{ expert.id }}</td>
                    <td>{{ expert.username }}</td>
                    <td>{{ expert.email }}</td>
                    <td>{{ expert.first_name }}</td>
                    <td>{{ expert.middle_name }}</td>
                    <td>{{ expert.last_name }}</td>
                    <td>{{ expert.barangay }}</td>
                    <td>{{ expert.phone_number }}</td>
                    <td><img src="{{ expert.profile_picture }}" class="rounded-circle img-fluid" width="40"></td>
                    <td>{{ expert.role }}</td>
                    <td>
                        {% if expert.proof_of_expertise %}
                            <button class="btn btn-info btn-sm" onclick="previewFile('{{ expert.proof_of_expertise }}')">
                                View
                            </button>
                        {% else %}
                            <span class="text-muted">No File</span>
                        {% endif %}
                    </td>
                    <td>{{ expert.license_number }}</td>
                    <td>{{ expert.position }}</td>
                    <td>{{ expert.status }}</td>
                    <td>
                        <a href="{% url 'view_expert' expert.id %}" class="btn btn-info btn-sm">VIEW</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Magsasaka Table -->
<div id="farmers-table" style="display: none;">
    <div class="d-flex justify-content-between align-items-center">
        <h4 class="text-center">Magsasaka Table</h4>
        <a href="{% url 'generate_farmer_pdf' %}" class="btn btn-success">
            <i class="fas fa-file-pdf"></i> Print Farmer Report
        </a>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>First Name</th>
                    <th>Middle Name</th>
                    <th>Last Name</th>
                    <th>Barangay</th>
                    <th>Phone</th>
                    <th>Profile</th>
                    <th>Role</th>
                    <th>Farm Size</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for farmer in farmers %}
                <tr>
                    <td>{{ farmer.id }}</td>
                    <td>{{ farmer.username }}</td>
                    <td>{{ farmer.email }}</td>
                    <td>{{ farmer.first_name }}</td>
                    <td>{{ farmer.middle_name }}</td>
                    <td>{{ farmer.last_name }}</td>
                    <td>{{ farmer.barangay }}</td>
                    <td>{{ farmer.phone_number }}</td>
                    <td><img src="{{ farmer.profile_picture }}" class="rounded-circle img-fluid" width="40"></td>
                    <td>{{ farmer.role }}</td>
                    <td>{{ farmer.farm_size }} hectares</td>
                    <td>
                        <a href="{% url 'view_farmer' farmer.id %}" class="btn btn-info btn-sm">VIEW</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>



<!-- Modal for Viewing Proof of Expertise -->
<div class="modal fade" id="proofModal" tabindex="-1" aria-labelledby="proofModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="proofModalLabel">Proof of Expertise</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div id="proofContent">
                    <!-- File preview will be loaded here dynamically -->
                </div>
            </div>
        </div>
    </div>
</div>

{% comment %} ULAT NG ADMIN PARA SA KONSULTASYON {% endcomment %}
{% comment %} <style>
    .filter-btn.active {
        border-width: 2px;
        font-weight: bold;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }
</style>

<div class="container mt-5">
    <h2 class="text-center fw-bold mb-4">Ulat ng Konsultasyon</h2>

    <!-- Search Bar -->
    <div class="mb-3">
        <input type="text" id="consultationSearchInput" class="form-control" placeholder="Paghahanap ayon sa eksperto, magsasaka, klasipikasyon, solusyon, o address...">
    </div>

    <div class="mb-3 text-end">
        <button class="btn btn-outline-primary me-2 filter-btn" data-filter="all">Lahat</button>
        <button class="btn btn-outline-success me-2 filter-btn" data-filter="solved">Nalutas</button>
        <button class="btn btn-outline-warning filter-btn" data-filter="unsolved">Hindi pa Nalulutas</button>
    </div>
    
    <div class="text-end mb-3">
        <button class="btn btn-success" onclick="printConsultation()">I-print ang Konsultasyon</button>
    </div>

    <div id="consultationPrintSection">
        <div class="print-header">
            <h2 class="text-center fw-bold">Ulat ng Konsultasyon</h2>
            <p>Petsa ng Ulat: <span id="consultationReportDate"></span></p>
            <div class="print-header">
                <h3>Municipal Agricultural Office</h3>
                <p>Municipality of Victoria</p>
                <p>San Gelacio, Victoria, Oriental Mindoro</p>
            </div>
            <hr>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-striped text-center">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Pangalan ng Eksperto</th>
                        <th>Posisyon</th>
                        <th>Barangay ng Eksperto</th>
                        <th>Pangalan ng Magsasaka</th>
                        <th>Barangay ng Magsasaka</th>
                        <th>Status</th>
                        <th>Klasipikasyon</th>
                        <th>Solusyon</th>
                        <th>Petsa ng Konsultasyon</th>
                    </tr>
                </thead>

                <tbody>
                    {% for message in consultations %}
                    <tr data-status="{% if message.is_solved %}solved{% else %}unsolved{% endif %}">
                        <td>{{ forloop.counter }}</td>

                        <!-- Expert Info -->
                        <td>
                            {% if message.receiver_expert %}
                                {{ message.receiver_expert.first_name }} {{ message.receiver_expert.last_name }}
                            {% elif message.sender_expert %}
                                {{ message.sender_expert.first_name }} {{ message.sender_expert.last_name }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if message.receiver_expert %}
                                {{ message.receiver_expert.position|default:"N/A" }}
                            {% elif message.sender_expert %}
                                {{ message.sender_expert.position|default:"N/A" }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            {% if message.receiver_expert %}
                                {{ message.receiver_expert.barangay }}
                            {% elif message.sender_expert %}
                                {{ message.sender_expert.barangay }}
                            {% else %}
                                -
                            {% endif %}
                        </td>

                        <!-- Farmer Info -->
                        <td>
                            {% if message.sender_farmer %}
                                {{ message.sender_farmer.first_name }} {{ message.sender_farmer.last_name }}
                            {% elif message.receiver_farmer %}
                                {{ message.receiver_farmer.first_name }} {{ message.receiver_farmer.last_name }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if message.sender_farmer %}
                                {{ message.sender_farmer.barangay }}
                            {% elif message.receiver_farmer %}
                                {{ message.receiver_farmer.barangay }}
                            {% else %}
                                -
                            {% endif %}
                        </td>

                        <!-- Solved Status -->
                        <td>
                            {% if message.is_solved %}
                                <span style="color:green;">&#10004;</span> <!-- checkmark -->
                            {% else %}
                                <span style="color:orange;">&#9203;</span> <!-- clock icon -->
                            {% endif %}
                        </td>

                        <!-- Classification -->
                        <td>
                            {% if message.is_solved %}
                                {{ message.classification|default:"-" }}
                            {% else %}
                                -
                            {% endif %}
                        </td>

                        <!-- Solution Description -->
                        <td>
                            {% if message.is_solved %}
                                {{ message.solution_description|default:"-" }}
                            {% else %}
                                -
                            {% endif %}
                        </td>

                        <!-- Date -->
                        <td>{{ message.timestamp|date:"F j, Y - g:i A" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="10" class="text-center">Walang ulat ng konsultasyon.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="print-footer">
            <hr>
            <p class="text-center">Wala ng sumunod na Impormasyon</p>
            <p class="text-center">AgriExpert@2025</p>
        </div>
    </div>
</div> {% endcomment %}

{% comment %} <script>
    function showAllExperts() {
        // 👇 Show the Eksperto table and filters
        document.getElementById('experts-table').style.display = 'block';
        document.getElementById('expert-filters').style.display = 'block';
        document.getElementById('farmers-table').style.display = 'none';
        document.getElementById('table-search-bar').style.display = 'block';

        // 👇 Show all expert rows regardless of status
        const rows = document.querySelectorAll('.expert-row');
        rows.forEach(row => {
            row.style.display = ''; // show all rows
        });
    }

    function showTable(table) {
        document.getElementById('experts-table').style.display = (table === 'experts') ? 'block' : 'none';
        document.getElementById('farmers-table').style.display = (table === 'farmers') ? 'block' : 'none';
        document.getElementById('expert-filters').style.display = (table === 'experts') ? 'block' : 'none';
    }

    function filterTable(status) {
        const rows = document.querySelectorAll('.expert-row');
        document.getElementById('experts-table').style.display = 'block';
        document.getElementById('expert-filters').style.display = 'block';
        document.getElementById('farmers-table').style.display = 'none';

        rows.forEach(row => {
            const rowStatus = row.getAttribute('data-status')?.trim();
            row.style.display = (rowStatus === status) ? '' : 'none';
        });
    }

    // Load all by default
    window.onload = function () {
        showAllExperts();
    };
</script>
<script>
    function previewFile(fileUrl) {
        console.log("Opening file:", fileUrl);
        let proofContent = document.getElementById("proofContent");
        proofContent.innerHTML = "";
    
        if (!fileUrl) {
            alert("No file available!");
            return;
        }
    
        let fileExtension = fileUrl.split('.').pop().toLowerCase();
    
        if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) {
            proofContent.innerHTML = `<img src="${fileUrl}" class="img-fluid" alt="Proof of Expertise">`;
        } else if (fileExtension === 'pdf') {
            proofContent.innerHTML = `<iframe src="${fileUrl}" width="100%" height="600px" style="border:none;"></iframe>`;
        } else if (['doc', 'docx'].includes(fileExtension)) {
            let convertUrl = `/convert_docx_to_pdf/?file_url=${encodeURIComponent(fileUrl)}`;
    
            fetch(convertUrl)
            .then(response => response.json())
            .then(data => {
                if (data.pdf_url) {
                    console.log("Using PDF URL:", data.pdf_url);
                    proofContent.innerHTML = `<iframe src="${data.pdf_url}" width="100%" height="600px" style="border:none;"></iframe>`;
                } else {
                    proofContent.innerHTML = `<p class="text-danger">Could not preview this document. <a href="${fileUrl}" target="_blank">Download here</a></p>`;
                }
            })
            .catch(error => {
                console.error("Error fetching PDF:", error);
                proofContent.innerHTML = `<p class="text-danger">Could not preview this document. <a href="${fileUrl}" target="_blank">Download here</a></p>`;
            });
        } else {
            proofContent.innerHTML = `<p class="text-danger">File format not supported. <a href="${fileUrl}" target="_blank">Download here</a></p>`;
        }
    
        let proofModal = new bootstrap.Modal(document.getElementById('proofModal'));
        proofModal.show();
    }
    
</script> {% endcomment %}

{% comment %} PARA SA ULAT NG KONSULTASYON {% endcomment %}

<!-- Print & Search Scripts -->
{% comment %} <style>
    .print-header, .print-footer {
        display: none;
    }

    @media print {
        body * {
            visibility: hidden;
        }

        #consultationPrintSection, #consultationPrintSection * {
            visibility: visible;
        }

        #consultationPrintSection {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        .print-header, .print-footer {
            display: block;
        }
    }
    </style>
    
    <!-- JS -->
    <script>
        function printConsultation() {
            var printContents = document.getElementById("consultationPrintSection").innerHTML;
            var originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
        }
    
        document.addEventListener("DOMContentLoaded", function () {
            // Set today's date in the report
            const now = new Date();
            const formattedDate = now.toLocaleDateString("en-PH", {
                year: "numeric",
                month: "long",
                day: "numeric"
            });
            document.getElementById("consultationReportDate").textContent = formattedDate;
    
            // Search functionality
            const searchInput = document.getElementById("consultationSearchInput");
            const rows = document.querySelectorAll("#consultationPrintSection tbody tr");
    
            searchInput.addEventListener("keyup", function () {
                const filter = searchInput.value.toLowerCase();
    
                rows.forEach(row => {
                    const cells = row.getElementsByTagName("td");
                    const expert = cells[1].textContent.toLowerCase();
                    const position = cells[2].textContent.toLowerCase();
                    const expertBarangay = cells[3].textContent.toLowerCase();
                    const farmer = cells[4].textContent.toLowerCase();
                    const farmerBarangay = cells[5].textContent.toLowerCase();
                    const status = cells[6].textContent.toLowerCase();
                    const classification = cells[7].textContent.toLowerCase();
                    const solution = cells[8].textContent.toLowerCase();
                    const date = cells[9].textContent.toLowerCase();
    
                    if (
                        expert.includes(filter) ||
                        position.includes(filter) ||
                        expertBarangay.includes(filter) ||
                        farmer.includes(filter) ||
                        farmerBarangay.includes(filter) ||
                        status.includes(filter) ||
                        classification.includes(filter) ||
                        solution.includes(filter) ||
                        date.includes(filter)
                    ) {
                        row.style.display = "";
                    } else {
                        row.style.display = "none";
                    }
                });
            });
    
            // Filter by status buttons
            const filterButtons = document.querySelectorAll(".filter-btn");
    
            filterButtons.forEach(button => {
                button.addEventListener("click", () => {
                    const filter = button.getAttribute("data-filter");
    
                    rows.forEach(row => {
                        const status = row.getAttribute("data-status");
    
                        if (filter === "all" || status === filter) {
                            row.style.display = "";
                        } else {
                            row.style.display = "none";
                        }
                    });
    
                    // Highlight active button
                    filterButtons.forEach(btn => btn.classList.remove("active"));
                    button.classList.add("active");
                });
            });
        });
    </script> {% endcomment %}
    
{% comment %} SCRIPT SA SEARCH NG REPORT SA DEMOGRAPHICS {% endcomment %}
{% comment %} <script>
    function showTable(role) {
    const expertTable = document.getElementById("experts-table");
    const farmerTable = document.getElementById("farmers-table");
    const filters = document.getElementById("expert-filters");
    const searchBar = document.getElementById("table-search-bar");

    if (role === "experts") {
        expertTable.style.display = "block";
        farmerTable.style.display = "none";
        filters.style.display = "block";
        searchBar.style.display = "block"; // Ensure search bar is shown for Eksperto
    } else if (role === "farmers") {
        expertTable.style.display = "none";
        farmerTable.style.display = "block";
        filters.style.display = "none";
        searchBar.style.display = "block"; // Ensure search bar is shown for Magsasaka
    }

    // Clear search field and reset rows
    document.getElementById("reportSearchInput").value = "";
    showAllRows();
}
</script>


<script>
    document.getElementById("reportSearchInput").addEventListener("keyup", function () {
        const value = this.value.toLowerCase();

        let visibleTable = null;

        if (document.getElementById("experts-table").style.display === "block") {
            visibleTable = document.querySelectorAll("#experts-table tbody tr");
        } else if (document.getElementById("farmers-table").style.display === "block") {
            visibleTable = document.querySelectorAll("#farmers-table tbody tr");
        }

        if (visibleTable) {
            visibleTable.forEach(row => {
                const rowText = row.textContent.toLowerCase();
                row.style.display = rowText.includes(value) ? "" : "none";
            });
        }
    });

    function showAllRows() {
        document.querySelectorAll("#experts-table tbody tr, #farmers-table tbody tr").forEach(row => {
            row.style.display = "";
        });
    }

    function filterTable(status) {
        const rows = document.querySelectorAll("#experts-table .expert-row");
        rows.forEach(row => {
            row.style.display = (row.dataset.status === status) ? "" : "none";
        });
    }
</script>
{% endblock %}  {% endcomment %}
